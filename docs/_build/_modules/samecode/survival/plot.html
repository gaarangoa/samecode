<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>samecode.survival.plot &mdash; samecode 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            samecode
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">samecode</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">samecode</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../survival.html">samecode.survival</a></li>
      <li class="breadcrumb-item active">samecode.survival.plot</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for samecode.survival.plot</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="kn">from</span> <span class="nn">lifelines</span> <span class="kn">import</span> <span class="n">KaplanMeierFitter</span>
<span class="kn">from</span> <span class="nn">lifelines.plotting</span> <span class="kn">import</span> <span class="n">add_at_risk_counts</span>
<span class="kn">from</span> <span class="nn">lifelines</span> <span class="kn">import</span> <span class="n">CoxPHFitter</span>
<span class="kn">import</span> <span class="nn">six</span> 
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">lifelines.utils</span> <span class="kn">import</span> <span class="n">median_survival_times</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">lifelines</span> <span class="kn">import</span> <span class="n">KaplanMeierFitter</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">lifelines</span> <span class="kn">import</span> <span class="n">CoxPHFitter</span>
<span class="kn">from</span> <span class="nn">..plot.pyplot</span> <span class="kn">import</span> <span class="n">subplots</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="c1"># plt.rcParams[&#39;font.family&#39;] = &#39;monospace&#39;</span>
<span class="c1"># plt.rcParams[&#39;font.family&#39;] = &#39;sans-serif&#39;</span>

<div class="viewcode-block" id="fix_string"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.fix_string">[docs]</a><span class="k">def</span> <span class="nf">fix_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sx</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">sx</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">ix</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
    
    <span class="k">return</span> <span class="n">sx</span></div>

<div class="viewcode-block" id="set_template"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.set_template">[docs]</a><span class="k">def</span> <span class="nf">set_template</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">template_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template_color&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">xy_font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xy_font_size&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">title_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_size&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="n">title_weight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_weight&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>


    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xy_font_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">template_color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xy_font_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">template_color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">template_color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">template_color</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">xy_font_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">xy_font_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">template_color</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">title_weight</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">template_color</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="compute_char_positions_ascii"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.compute_char_positions_ascii">[docs]</a><span class="k">def</span> <span class="nf">compute_char_positions_ascii</span><span class="p">(</span><span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="c1"># Define the characters for which we want to compute positions</span>
    <span class="c1"># This example uses lowercase letters; expand the set as needed</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ!&quot;#$%&amp;&#39;()*+,-./:;&lt;=&gt;?@[\]^_`{|}~&quot;&quot;&quot;</span>
    
    <span class="n">positions</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
        <span class="c1"># Add a text annotation for the character</span>
        <span class="n">text_obj</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">char</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
        
        <span class="c1"># Draw the figure to make the renderer available</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        
        <span class="c1"># Get bounding box of the text in axes coordinates</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">text_obj</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="o">.</span><span class="n">inverted</span><span class="p">())</span>
        
        <span class="c1"># Store start and end x-coordinates</span>
        <span class="n">start_x</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">x0</span>
        <span class="n">end_x</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">x1</span>
        
        <span class="n">positions</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_x</span>
        
        <span class="c1"># Remove the text object to plot the next character</span>
        <span class="n">text_obj</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Close the figure</span>
    <span class="k">return</span> <span class="n">positions</span></div>

<div class="viewcode-block" id="get_end_position"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.get_end_position">[docs]</a><span class="k">def</span> <span class="nf">get_end_position</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">label</span><span class="p">])</span></div>

<div class="viewcode-block" id="KMPlot"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.KMPlot">[docs]</a><span class="k">class</span> <span class="nc">KMPlot</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Example: </span>

<span class="sd">        axs = subplots(cols=1, rows=1, w=6, h=4)</span>
<span class="sd">        KMPlot(data, time=time, event=event, label=[&#39;bin_risk&#39;, &#39;Treatment&#39;]).plot(</span>
<span class="sd">            labels = [&#39;GP_{}&#39;.format(&#39;IO&#39;), &#39;GN_{}&#39;.format(&#39;IO&#39;), &#39;GP_{}&#39;.format(&#39;Chemo&#39;), &#39;GN_{}&#39;.format(&#39;Chemo&#39;)],</span>
<span class="sd">            ax=axs[1],</span>
<span class="sd">            comparisons=[</span>
<span class="sd">                [&#39;GP_{}&#39;.format(&#39;IO&#39;), &#39;GP_{}&#39;.format(&#39;Chemo&#39;), &#39;GP(IO vs Chemo): &#39;], </span>
<span class="sd">                [&#39;GN_{}&#39;.format(&#39;IO&#39;), &#39;GN_{}&#39;.format(&#39;Chemo&#39;), &#39;GN(IO vs Chemo): &#39;], </span>
<span class="sd">                [&#39;GP_{}&#39;.format(&#39;IO&#39;), &#39;GN_{}&#39;.format(&#39;IO&#39;), &#39;IO(GP vs GN): &#39;], </span>
<span class="sd">                [&#39;GP_{}&#39;.format(&#39;Chemo&#39;), &#39;GN_{}&#39;.format(&#39;Chemo&#39;), &#39;Chemo(GP vs GN): &#39;]</span>
<span class="sd">            ],</span>
<span class="sd">            title=&#39;PFS - IO vs Chemo&#39;,</span>
<span class="sd">        );</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
<div class="viewcode-block" id="KMPlot.compare"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.KMPlot.compare">[docs]</a>    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">pass</span></div>
    
<div class="viewcode-block" id="KMPlot.plot"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.KMPlot.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot the Kaplan-Meier survival curves.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            - labels (list, optional): Labels to plot. Default is None.</span>
<span class="sd">            - display_labels (list, optional): Labels to display. Default is None.</span>
<span class="sd">            - ax (matplotlib.axes.Axes, optional): Matplotlib axes object. Default is False.</span>
<span class="sd">            - colors (list or str, optional): Colors for each label. Default is determined by sns.color_palette.</span>
<span class="sd">            - linestyle (list, optional): Line styles for each label. Default is [&#39;-&#39;]*len(plot_labels).</span>
<span class="sd">            - xy_font_size (int, optional): Font size for x and y axis labels. Default is 12.</span>
<span class="sd">            - label_height_adj (float, optional): Adjustment for space between labels on the y-axis. Default is 0.05.</span>
<span class="sd">            - template_color (str, optional): Color for template. Default is &#39;black&#39;.</span>
<span class="sd">            - comparisons (list, optional): List of comparisons between two curves. Default is [].</span>
<span class="sd">            - title_weight (str, optional): Font weight for title. Default is &#39;normal&#39;.</span>
<span class="sd">            - title_size (int, optional): Font size for title. Default is 14.</span>
<span class="sd">            - hr_color (str, optional): Color for hazard ratio layer. Default is determined by self.colors.</span>
<span class="sd">            - x_legend (float, optional): X-coordinate for legend. Default is 0.15.</span>
<span class="sd">            - y_legend (float, optional): Y-coordinate for legend. Default is 0.95.</span>
<span class="sd">            - legend_font_size (int, optional): Font size for legend. Default is 10.</span>
<span class="sd">            - show_censor (bool, optional): Whether to show censor. Default is True.</span>
<span class="sd">            - ylabel (str, optional): Label for y-axis. Default is &#39;Survival Probability&#39;.</span>
<span class="sd">            - xlabel (str, optional): Label for x-axis. Default is &#39;Timeline&#39;.</span>
<span class="sd">            - ci_show (bool, optional): Whether to show confidence interval. Default is False.</span>
<span class="sd">            - label_weight (str, optional): Font weight for labels. Default is &#39;bold&#39;.</span>
<span class="sd">            - x_hr_legend (float, optional): X-coordinate for hazard ratio legend. Default is 0.0.</span>
<span class="sd">            - y_hr_legend (float, optional): Y-coordinate for hazard ratio legend. Default is -0.3.</span>
<span class="sd">            - hr_font_size (int, optional): Font size for hazard ratio legend. Default is 10.</span>
<span class="sd">            - saturation (float, optional): Saturation level for colors. Default is 1.0.</span>
<span class="sd">            - linewidth (float, optional): Line width for the curves. Default is 1.5.</span>
<span class="sd">            - palette (str, optional): Palette for color selection. Default is &#39;Paired&#39;.</span>
<span class="sd">            - show_cesor (bool, optional): Whether to show censor. Default is True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            - ax: Matplotlib axes object.</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>

        
        <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span>

        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">plot_labels</span> <span class="o">=</span> <span class="n">label</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
        
        <span class="n">display_labels</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;display_labels&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">colors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;colors&#39;</span><span class="p">,</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;palette&#39;</span><span class="p">,</span> <span class="s1">&#39;Paired&#39;</span><span class="p">),</span> <span class="mi">100</span><span class="p">,</span> <span class="n">desat</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;saturation&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">linestyle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linestyle&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">plot_labels</span><span class="p">))</span>
        <span class="n">xy_font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xy_font_size&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">label_height_adj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_height_adj&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="n">template_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template_color&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">to_compare</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;comparisons&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">title_weight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">)</span>
        <span class="n">title_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_size&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">]</span>

        <span class="n">label_max_l</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_names_size</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">label_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plot_labels</span><span class="p">):</span>
            <span class="n">label_max_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_names_size</span><span class="p">[</span><span class="n">label_</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">label_</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">lx</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label_</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">ci_show</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ci_show&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> 
                <span class="n">show_censors</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;show_censor&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">lx</span><span class="p">],</span>
                <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">[</span><span class="n">lx</span><span class="p">],</span>
                <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
            <span class="p">)</span>
            
            <span class="c1"># median survival time</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label_</span><span class="p">]</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">label_</span><span class="p">],</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label_</span><span class="p">]</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#a19595&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label_</span><span class="p">]</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">label_</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>

        <span class="c1"># plt.rcParams[&#39;font.family&#39;] = kwargs.get(&#39;font_family_labels&#39;, &#39;Roboto Mono for Powerline&#39;)</span>
        <span class="n">x_legend</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x_legend&#39;</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
        <span class="n">y_legend</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y_legend&#39;</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)</span>
        <span class="n">legend_font_size</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_font_size&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="n">char_positions</span> <span class="o">=</span> <span class="n">compute_char_positions_ascii</span><span class="p">(</span><span class="n">font_size</span><span class="o">=</span><span class="n">legend_font_size</span><span class="p">)</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_names_list</span><span class="o">.</span><span class="n">values</span><span class="p">()]:</span>
            <span class="n">posi</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">label</span><span class="p">:</span>
                <span class="n">posi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_end_position</span><span class="p">(</span><span class="s2">&quot;_._&quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span><span class="p">,</span> <span class="n">char_positions</span><span class="p">))</span>
            <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posi</span><span class="p">)</span>

        <span class="n">max_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">max_pos</span><span class="p">)</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">max_pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;legend&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">label_max_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">label_max_l</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">label_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">plot_labels</span><span class="p">):</span>                
                <span class="c1"># vrx = fix_string(self.label_names_list[label_], self.label_names_size[label_], label_max_l)</span>

                <span class="k">for</span> <span class="n">lix</span><span class="p">,</span> <span class="n">vx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_names_list</span><span class="p">[</span><span class="n">label_</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                        <span class="n">vx</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">max_pos</span><span class="p">[</span><span class="n">lix</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_legend</span><span class="p">,</span> <span class="n">y_legend</span> <span class="o">-</span><span class="n">lx</span><span class="o">*</span><span class="n">label_height_adj</span><span class="p">),</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> 
                        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">max_pos</span><span class="p">[</span><span class="n">lix</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_legend</span><span class="p">,</span> <span class="n">y_legend</span> <span class="o">-</span><span class="n">lx</span><span class="o">*</span><span class="n">label_height_adj</span><span class="p">),</span>
                        <span class="n">weight</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label_weight&quot;</span><span class="p">,</span> <span class="s1">&#39;bold&#39;</span><span class="p">),</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">legend_font_size</span><span class="p">,</span> 
                        <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">label_</span><span class="p">],</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.1&#39;</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="c1"># print(max_pos)</span>
        <span class="c1"># rect=mpatches.Rectangle((0, 0), 1,1, </span>
        <span class="c1">#                 fill = True,</span>
        <span class="c1">#                 color = &quot;purple&quot;,</span>
        <span class="c1">#                 linewidth = 2, zorder=0)</span>

        <span class="c1"># ax.add_patch(rect)</span>

        <span class="c1"># Cox PH Fitters for HR estimation</span>
        <span class="n">xcompare</span> <span class="o">=</span> <span class="p">[[(</span><span class="s1">&#39;__label__&#39;</span><span class="p">,</span> <span class="s1">&#39;__label__&#39;</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">HR</span><span class="se">\t</span><span class="s2">(95% CI)</span><span class="se">\t</span><span class="s2">P value&quot;</span><span class="p">]]</span>
        <span class="n">xinfo</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">HR</span><span class="se">\t</span><span class="s2">(95% CI)</span><span class="se">\t</span><span class="s2">P value&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)]]</span>
        <span class="n">xinfo_space</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">to_compare</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="p">[</span><span class="n">tar</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">hr_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="p">[</span><span class="n">tar</span><span class="p">,</span> <span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
                <span class="n">hr_label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">: &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tar</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">__label__</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">tar</span><span class="p">,</span> <span class="n">ref</span><span class="p">])][[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;__label__&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">__label__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">__label__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tar</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">__label__</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">__label__</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

            <span class="n">cph</span> <span class="o">=</span> <span class="n">CoxPHFitter</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">duration_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">event_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">)</span> 
            <span class="n">cph</span> <span class="o">=</span> <span class="n">cph</span><span class="o">.</span><span class="n">summary</span><span class="p">[[</span><span class="s1">&#39;exp(coef)&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;exp(coef) lower 95%&#39;</span><span class="p">,</span> <span class="s1">&#39;exp(coef) upper 95%&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="n">cph</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;HR&quot;</span><span class="p">:</span> <span class="n">cph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exp(coef)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;HR_lo&quot;</span><span class="p">:</span> <span class="n">cph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exp(coef) lower 95%&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;HR_hi&quot;</span><span class="p">:</span> <span class="n">cph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exp(coef) upper 95%&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="n">cph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="p">}</span>
            
            <span class="c1"># color for HR </span>
            <span class="n">hr_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hr_color&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">tar</span><span class="p">])</span>
            
            <span class="c1"># xinfo_ = &#39;{}\tHR={:.2f}\t(CI 95%: {:.2f} - {:.2f})\tP-value={:.2e}&#39;.format(hr_label, cph.get(&#39;HR&#39;), cph.get(&#39;HR_lo&#39;), cph.get(&#39;HR_hi&#39;), cph.get(&#39;P&#39;))</span>
            <span class="n">xinfo_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:.2f}</span><span class="se">\t</span><span class="s1">(</span><span class="si">{:.2f}</span><span class="s1">-</span><span class="si">{:.2f}</span><span class="s1">)</span><span class="se">\t</span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hr_label</span><span class="p">,</span> <span class="n">cph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HR&#39;</span><span class="p">),</span> <span class="n">cph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HR_lo&#39;</span><span class="p">),</span> <span class="n">cph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HR_hi&#39;</span><span class="p">),</span> <span class="n">cph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">))</span>
            <span class="n">xinfo</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xinfo_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)])</span>
            <span class="n">xinfo_space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span><span class="n">get_end_position</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">ii</span><span class="o">+</span><span class="s2">&quot;_._&quot;</span><span class="p">,</span> <span class="n">char_positions</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">xinfo_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)]</span>
            <span class="p">)</span>


            <span class="n">xcompare</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="p">(</span><span class="n">tar</span><span class="p">,</span> <span class="n">ref</span><span class="p">),</span> <span class="n">xinfo_</span>
            <span class="p">])</span>

        <span class="k">if</span> <span class="n">xinfo_space</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">max_pos_hr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xinfo_space</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">max_pos_hr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">max_pos_hr</span><span class="p">)</span>
            <span class="n">max_pos_hr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">max_pos_hr</span><span class="p">)</span>

        <span class="n">x_hr_legend</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x_hr_legend&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">y_hr_legend</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y_hr_legend&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">hr_font_size</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hr_font_size&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="n">max_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xinfo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xcompare</span><span class="p">):</span>
            
            <span class="n">tar</span><span class="p">,</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">k</span> 
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcompare</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">hr_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hr_color&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">tar</span><span class="p">])</span>
            
            <span class="c1"># vx = fix_string(v, max_values[ix], max_values.max(axis=0))</span>
            <span class="k">for</span> <span class="n">lix</span><span class="p">,</span> <span class="n">vx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                    <span class="n">vx</span><span class="p">,</span> 
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_hr_legend</span> <span class="o">+</span> <span class="n">max_pos_hr</span><span class="p">[</span><span class="n">lix</span><span class="p">],</span> <span class="n">y_hr_legend</span> <span class="o">-</span> <span class="n">ix</span><span class="o">*</span><span class="n">label_height_adj</span><span class="p">),</span> 
                    <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> 
                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x_hr_legend</span> <span class="o">+</span> <span class="n">max_pos_hr</span><span class="p">[</span><span class="n">lix</span><span class="p">],</span> <span class="n">y_hr_legend</span> <span class="o">-</span> <span class="n">ix</span><span class="o">*</span><span class="n">label_height_adj</span><span class="p">),</span>
                    <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> 
                    <span class="n">size</span><span class="o">=</span><span class="n">hr_font_size</span><span class="p">,</span> 
                    <span class="n">color</span><span class="o">=</span><span class="n">hr_color</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.1&#39;</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># plt.rcParams[&#39;font.family&#39;] = kwargs.get(&#39;font_family&#39;, &#39;&#39;)   </span>
        
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Survival Probability&#39;</span><span class="p">),</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xy_font_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">template_color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Timeline&#39;</span><span class="p">),</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xy_font_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">template_color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">template_color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">template_color</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">xy_font_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">xy_font_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">template_color</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">title_weight</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="o">-</span><span class="mi">6</span><span class="p">:])</span>
        
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">template_color</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="KMPlot.fit"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.KMPlot.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">event</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">kmfs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">__label__</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">__label__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_names_list</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_names_size</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
            <span class="n">kmf</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">()</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">__label__</span> <span class="o">==</span> <span class="n">label</span>
            <span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="n">time</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="n">event</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">label</span> <span class="p">))</span>
            
            <span class="c1"># lo = list((kmfs[label].confidence_interval_ -  0.5).abs().sort_values(&#39;{}_lower_0.95&#39;.format(label)).index)[0]</span>
            <span class="c1"># hi = list((kmfs[label].confidence_interval_ -  0.5).abs().sort_values(&#39;{}_upper_0.95&#39;.format(label)).index)[0]</span>

            <span class="n">cis</span> <span class="o">=</span> <span class="n">median_survival_times</span><span class="p">(</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">confidence_interval_</span><span class="p">)</span>
            <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cis</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1"># self.label_names[label] = &#39;{}: N={}; Q2={:.1f}&#39;.format(label, self.counts[label], kmfs[label].median_survival_time_)</span>
            <span class="c1"># self.label_names[label] = &#39;{}: N={}; Q2={:.2f} (CI 95% {:.2f} - {:.2f})&#39;.format(label, self.counts[label], kmfs[label].median_survival_time_, lo, hi)</span>
            <span class="c1"># self.label_names_list[label] = &#39;{}\tN={}\tQ2={:.2f} (CI 95% {:.2f} - {:.2f})&#39;.format(label, self.counts[label], kmfs[label].median_survival_time_, lo, hi)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">label_names</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> </span><span class="si">{:.1f}</span><span class="s1"> (</span><span class="si">{:.1f}</span><span class="s1"> - </span><span class="si">{:.1f}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_names_list</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:.1f}</span><span class="se">\t</span><span class="s1">(</span><span class="si">{:.1f}</span><span class="s1"> - </span><span class="si">{:.1f}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_names_size</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_names_list</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">label_names</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;N Median (95%CI)&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_names_list</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="se">\t</span><span class="s1">N</span><span class="se">\t</span><span class="s1">Median</span><span class="se">\t</span><span class="s1">(95% CI)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_names_size</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;Median&#39;</span><span class="p">,</span><span class="s1">&#39;(95%CI)&#39;</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="s1">&#39;__label__&#39;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span> <span class="o">=</span> <span class="n">kmfs</span></div></div>

<div class="viewcode-block" id="PlotSurvival"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PlotSurvival">[docs]</a><span class="k">class</span> <span class="nc">PlotSurvival</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    -----------</span>
<span class="sd">    Input: </span>
<span class="sd">        data: </span>
<span class="sd">        time: </span>
<span class="sd">        censor:</span>
<span class="sd">    -----------</span>
<span class="sd">    Methods:</span>

<span class="sd">    -----------</span>
<span class="sd">    Output: </span>
<span class="sd">     </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">censor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OS_AVAL</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OS_CNSR</span> <span class="o">=</span> <span class="n">censor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span> <span class="o">=</span> <span class="p">{}</span>
        
<div class="viewcode-block" id="PlotSurvival.hazard"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PlotSurvival.hazard">[docs]</a>    <span class="k">def</span> <span class="nf">hazard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">hrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">tx</span><span class="p">,</span> <span class="n">target_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">):</span>
            <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kmf</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">hr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">target_name</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">target_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">target_name</span><span class="p">))</span>
                <span class="n">noix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_CNSR</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_AVAL</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> vs </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">):</span> <span class="mi">1</span><span class="p">}))</span>
                <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">noix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_CNSR</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">noix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_AVAL</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> vs </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">):</span> <span class="mi">0</span><span class="p">}))</span>
                    
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

                <span class="n">cph</span> <span class="o">=</span> <span class="n">CoxPHFitter</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">target_name</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cph</span><span class="o">.</span><span class="n">summary</span><span class="p">[[</span><span class="s1">&#39;exp(coef)&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;exp(coef) lower 95%&#39;</span><span class="p">,</span> <span class="s1">&#39;exp(coef) upper 95%&#39;</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cph</span> <span class="o">=</span> <span class="n">cph</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">target_name</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="PlotSurvival.add"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PlotSurvival.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">kmf</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">();</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="n">kmf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_AVAL</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_CNSR</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">name</span> <span class="p">)),</span> <span class="n">ix</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span></div>
    
<div class="viewcode-block" id="PlotSurvival.table"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PlotSurvival.table">[docs]</a>    <span class="k">def</span> <span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axs</span><span class="p">):</span>
        <span class="n">survs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()])</span> <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">():</span>
                <span class="n">event_table_slice</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">event_table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">at_risk</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">at_risk</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">removed</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">tick</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;at_risk&quot;</span><span class="p">,]]</span>
                                <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;at_risk&quot;</span><span class="p">:</span> <span class="s2">&quot;min&quot;</span><span class="p">,})</span>
                            <span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">event_table_slice</span><span class="o">.</span><span class="n">at_risk</span><span class="p">):</span> 
                    <span class="k">continue</span>
        
                <span class="n">counts</span><span class="o">.</span><span class="n">extend</span><span class="p">([{</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)}</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">event_table_slice</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;at_risk&quot;</span><span class="p">,</span> <span class="p">]]</span> <span class="p">])</span>
            <span class="n">survs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span>

        <span class="n">survs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">survs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">survs</span><span class="o">.</span><span class="n">Time</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">survs</span><span class="o">.</span><span class="n">Time</span><span class="p">))</span>
        <span class="n">survs</span> <span class="o">=</span> <span class="n">survs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">survs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">survs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span></div>
        
<div class="viewcode-block" id="PlotSurvival.plot"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PlotSurvival.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[],</span> <span class="n">line_styles</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">legend_font_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">legend_weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">table_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.38</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">lbox</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]):</span>
        
        <span class="n">remove_plot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">remove_plot</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ref</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">hazard</span><span class="p">()</span>
        
        <span class="n">linest</span> <span class="o">=</span> <span class="n">line_styles</span>

        <span class="n">kmfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ixx</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">):</span>
            <span class="n">kmf</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">hr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">colors</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">ixx</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">line_styles</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                <span class="n">linest</span> <span class="o">=</span> <span class="n">line_styles</span><span class="p">[</span><span class="n">ixx</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">hr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">ix</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">label2</span><span class="o">=</span><span class="s1">&#39;HR: </span><span class="si">{:.2f}</span><span class="s1"> [</span><span class="si">{:.2f}</span><span class="s1"> - </span><span class="si">{:.2f}</span><span class="s1">] P: </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,(</span><span class="n">ixx</span><span class="o">*</span><span class="n">lbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">lbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">legend_weight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">legend_font_size</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
                    <span class="c1"># t.set_bbox(dict(facecolor=&#39;white&#39;, alpha=0.5, edgecolor=&#39;white&#39;))</span>
                    
                    <span class="n">kmf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_censors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linest</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">);</span>
                <span class="n">kmfs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="n">kmf</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">hr</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">ix</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">kmf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_censors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linest</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">);</span>
                <span class="n">kmfs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="n">kmf</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">hr</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Survival Probability&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_font_size</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Timeline&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_font_size</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    
                <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">legend</span><span class="p">:</span> 
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;linecolor&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">legend_font_size</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">legend_weight</span><span class="p">,</span> <span class="s1">&#39;stretch&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">})</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="n">kmfs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        
        

        <span class="k">if</span> <span class="n">table</span><span class="p">:</span> 
            <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span>
            <span class="c1"># pd.plotting.table(ax, self.counts.iloc[:, ], loc=&#39;bottom&#39;, colLoc=&#39;right&#39;, rowLoc=&#39;right&#39;, edges=&#39;open&#39;, bbox=bbox);</span>
            
            <span class="n">mpl_table</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">cellText</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">colLabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">rowLabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
            
            <span class="n">mpl_table</span><span class="o">.</span><span class="n">auto_set_font_size</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">mpl_table</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">table_font_size</span><span class="p">)</span>
            
            <span class="n">row_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">colors</span>
            <span class="n">header_columns</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">header_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span>
            <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">))</span> <span class="o">+</span> <span class="mi">5</span><span class="p">])</span>
            
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">mpl_table</span><span class="o">.</span><span class="n">_cells</span><span class="p">):</span>
                
                <span class="n">cell</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edge_color</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">header_columns</span><span class="p">:</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">set_text_props</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">row_colors</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">set_text_props</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">row_colors</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>   
        
        <span class="k">if</span> <span class="n">remove_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="PrettyPlotSurvival"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PrettyPlotSurvival">[docs]</a><span class="k">class</span> <span class="nc">PrettyPlotSurvival</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    -----------</span>
<span class="sd">    Input: </span>
<span class="sd">        data: </span>
<span class="sd">        time: </span>
<span class="sd">        censor:</span>
<span class="sd">    -----------</span>
<span class="sd">    Methods:</span>

<span class="sd">    -----------</span>
<span class="sd">    Output: </span>
<span class="sd">     </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">censor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OS_AVAL</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OS_CNSR</span> <span class="o">=</span> <span class="n">censor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span> <span class="o">=</span> <span class="p">{}</span>
        
<div class="viewcode-block" id="PrettyPlotSurvival.hazard"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PrettyPlotSurvival.hazard">[docs]</a>    <span class="k">def</span> <span class="nf">hazard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">hrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">tx</span><span class="p">,</span> <span class="n">target_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">):</span>
            <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kmf</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">hr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">target_name</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">target_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">target_name</span><span class="p">))</span>
                <span class="n">noix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_CNSR</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_AVAL</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> vs </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">):</span> <span class="mi">1</span><span class="p">}))</span>
                <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">noix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_CNSR</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">noix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_AVAL</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> vs </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">):</span> <span class="mi">0</span><span class="p">}))</span>
                    
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

                <span class="n">cph</span> <span class="o">=</span> <span class="n">CoxPHFitter</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">target_name</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cph</span><span class="o">.</span><span class="n">summary</span><span class="p">[[</span><span class="s1">&#39;exp(coef)&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;exp(coef) lower 95%&#39;</span><span class="p">,</span> <span class="s1">&#39;exp(coef) upper 95%&#39;</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cph</span> <span class="o">=</span> <span class="n">cph</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">target_name</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="PrettyPlotSurvival.add"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PrettyPlotSurvival.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">kmf</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">();</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="n">kmf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_AVAL</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_CNSR</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">name</span> <span class="p">)),</span> <span class="n">ix</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span></div>
    
<div class="viewcode-block" id="PrettyPlotSurvival.table"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PrettyPlotSurvival.table">[docs]</a>    <span class="k">def</span> <span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axs</span><span class="p">):</span>
        <span class="n">survs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()])</span> <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">():</span>
                <span class="n">event_table_slice</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">event_table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">at_risk</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">at_risk</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">removed</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">tick</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;at_risk&quot;</span><span class="p">,]]</span>
                                <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;at_risk&quot;</span><span class="p">:</span> <span class="s2">&quot;min&quot;</span><span class="p">,})</span>
                            <span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">event_table_slice</span><span class="o">.</span><span class="n">at_risk</span><span class="p">):</span> 
                    <span class="k">continue</span>
        
                <span class="n">counts</span><span class="o">.</span><span class="n">extend</span><span class="p">([{</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)}</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">event_table_slice</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;at_risk&quot;</span><span class="p">,</span> <span class="p">]]</span> <span class="p">])</span>
            <span class="n">survs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span>

        <span class="n">survs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">survs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">survs</span><span class="o">.</span><span class="n">Time</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">survs</span><span class="o">.</span><span class="n">Time</span><span class="p">))</span>
        <span class="n">survs</span> <span class="o">=</span> <span class="n">survs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">survs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">survs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span></div>
        
<div class="viewcode-block" id="PrettyPlotSurvival.plot"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.PrettyPlotSurvival.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[],</span> <span class="n">line_styles</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">legend_font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">legend_weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">table_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.38</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">medians_offset</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">labels_offset</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        

        <span class="n">remove_plot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">remove_plot</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ref</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">hazard</span><span class="p">()</span>
        
        <span class="n">linest</span> <span class="o">=</span> <span class="n">line_styles</span>

        <span class="n">kmfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ixx</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">):</span>
            <span class="n">kmf</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">hr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kmfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">colors</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">ixx</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">line_styles</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                <span class="n">linest</span> <span class="o">=</span> <span class="n">line_styles</span><span class="p">[</span><span class="n">ixx</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">hr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (N=</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">ix</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">label2</span><span class="o">=</span><span class="s1">&#39;HR=</span><span class="si">{:.2f}</span><span class="s1"> (95% CI: </span><span class="si">{:.2f}</span><span class="s1">, </span><span class="si">{:.2f}</span><span class="s1">); P=</span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="c1"># ax.text(0,(ixx*lbox[0]) + lbox[1], label2, color=col, weight=legend_weight, fontsize=legend_font_size, transform=ax.transAxes)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">label2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">legend_weight</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">legend_font_size</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
                    <span class="c1"># t.set_bbox(dict(facecolor=&#39;white&#39;, alpha=0.5, edgecolor=&#39;white&#39;))</span>
                    
                    <span class="n">kmf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_censors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                        <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linest</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> 
                        <span class="n">label</span><span class="o">=</span><span class="n">label</span>
                    <span class="p">)</span>
                    
                    <span class="c1"># median survival time </span>
                    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span> <span class="o">+</span> <span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="o">*</span><span class="n">medians_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.53</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#a19595&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#a19595&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    
                    <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kmf</span><span class="o">.</span><span class="n">survival_function_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">labels_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>

                <span class="n">kmfs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="n">kmf</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">hr</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (N=</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">ix</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    
                    <span class="n">kmf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_censors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                        <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linest</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> 
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span>
                    <span class="p">)</span>
                    
                    <span class="c1"># median survival time</span>
                    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span> <span class="o">-</span> <span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="o">*</span><span class="n">medians_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#a19595&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">kmf</span><span class="o">.</span><span class="n">median_survival_time_</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#a19595&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    
                    <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kmf</span><span class="o">.</span><span class="n">survival_function_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">labels_offset</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">labels_offset</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                                        
                <span class="n">kmfs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="n">kmf</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">hr</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Survival Probability&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_font_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Timeline&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_font_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>
                    
                <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">legend</span><span class="p">:</span> 
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;linecolor&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">legend_font_size</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">legend_weight</span><span class="p">,</span> <span class="s1">&#39;stretch&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">})</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
        
        <span class="n">kmf0</span> <span class="o">=</span> <span class="n">kmfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kmf1</span> <span class="o">=</span> <span class="n">kmfs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">kmf0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">survival_function_</span><span class="p">,</span> <span class="n">kmf1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">survival_function_</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dfs</span><span class="p">[</span><span class="n">kmf0</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">dfs</span><span class="p">[</span><span class="n">kmf1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">fill_alpha</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">fill_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="n">kmfs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        
        

        <span class="k">if</span> <span class="n">table</span><span class="p">:</span> 
            <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span>
            <span class="c1"># pd.plotting.table(ax, self.counts.iloc[:, ], loc=&#39;bottom&#39;, colLoc=&#39;right&#39;, rowLoc=&#39;right&#39;, edges=&#39;open&#39;, bbox=bbox);</span>
            
            <span class="n">mpl_table</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">cellText</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">colLabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">rowLabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
            
            <span class="n">mpl_table</span><span class="o">.</span><span class="n">auto_set_font_size</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">mpl_table</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">table_font_size</span><span class="p">)</span>
            
            <span class="n">row_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">colors</span>
            <span class="n">header_columns</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">header_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span>
            <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">))</span> <span class="o">+</span> <span class="mi">5</span><span class="p">])</span>
            
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">mpl_table</span><span class="o">.</span><span class="n">_cells</span><span class="p">):</span>
                
                <span class="n">cell</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edge_color</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">header_columns</span><span class="p">:</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">set_text_props</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">row_colors</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">set_text_props</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">row_colors</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>   
        
        <span class="k">if</span> <span class="n">remove_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="forestplot"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.forestplot">[docs]</a><span class="k">def</span> <span class="nf">forestplot</span><span class="p">(</span><span class="n">perf</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="p">[],</span> <span class="n">hr</span><span class="o">=</span><span class="s1">&#39;hr&#39;</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="s1">&#39;hr_hi&#39;</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="s1">&#39;hr_lo&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot a forest plot.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        - perf (DataFrame): Dataframe containing performance data.</span>
<span class="sd">        - figsize (tuple, optional): Figure size. Default is (8, 3).</span>
<span class="sd">        - ax (matplotlib.axes.Axes, optional): Matplotlib axes object. Default is an empty list [].</span>
<span class="sd">        - hr (str, optional): Column name for hazard ratio. Default is &#39;hr&#39;.</span>
<span class="sd">        - hi (str, optional): Column name for upper confidence interval. Default is &#39;hr_hi&#39;.</span>
<span class="sd">        - lo (str, optional): Column name for lower confidence interval. Default is &#39;hr_lo&#39;.</span>
<span class="sd">        - marker (str, optional): Marker style. Default is &#39;D&#39;.</span>
<span class="sd">        - marker_s (int, optional): Marker size. Default is 80.</span>
<span class="sd">        - marker_edgecolor (str, optional): Marker edge color. Default is &#39;#000000&#39;.</span>
<span class="sd">        - marker_c (str, optional): Marker color. Default is &#39;#000000&#39;.</span>
<span class="sd">        - label_fontsize (int, optional): Font size for labels. Default is 10.</span>
<span class="sd">        - table_fontsize (int, optional): Font size for table. Default is 10.</span>
<span class="sd">        - xlabel (str, optional): Label for x-axis. Default is &#39;Hazard Ratio&#39;.</span>
<span class="sd">        - xlim (list, optional): Limits for x-axis. Default is [0.25, 1.5].</span>
<span class="sd">        - variable (str, optional): Column name for variable. Default is &#39;cluster&#39;.</span>
<span class="sd">        - xticks (list, optional): Tick positions for x-axis. Default is None.</span>
<span class="sd">        - xticks_labelsize (int, optional): Font size for x-axis ticks. Default is 10.</span>
<span class="sd">        - N1 (str, optional): Name for the first group. Default is &#39;N1&#39;.</span>
<span class="sd">        - N2 (str, optional): Name for the second group. Default is &#39;N2&#39;.</span>
<span class="sd">        - sort_by (str, optional): Column name for sorting. Default is False.</span>
<span class="sd">        - population (str, optional): Column name for population. Default is None.</span>
<span class="sd">        - variables (set, optional): Set of variables. Default is set(perf[variable].values).</span>
<span class="sd">        - variable_shapes (dict, optional): Dictionary mapping variables to marker shapes. Default is {variable: marker}.</span>
<span class="sd">        - populations (set, optional): Set of populations. Default is set(perf[population].values).</span>
<span class="sd">        - population_name (str, optional): Column name for population name. Default is None.</span>
<span class="sd">        - population_colors (dict, optional): Dictionary mapping populations to colors. Default is {population: &#39;black&#39;}.</span>
<span class="sd">        - group (str, optional): Column name for group. Default is None.</span>
<span class="sd">        - groups (set, optional): Set of groups. Default is set(perf[group].values) if group else [np.nan].</span>
<span class="sd">        - offset (int, optional): Offset value. Default is 1.</span>
<span class="sd">        - offset2 (float, optional): Another offset value. Default is 0.2.</span>
<span class="sd">        - population_label_fixed_position (float, optional): Fixed position for population label. Default is None.</span>
<span class="sd">        - population_label_offset (float, optional): Offset for population label. Default is 0.1.</span>
<span class="sd">        - population_label_fontsize (int, optional): Font size for population label. Default is 10.</span>
<span class="sd">        - xlabel_offset (float, optional): Offset for x-axis label. Default is xlim[1].</span>
<span class="sd">        - ylabel_offset (float, optional): Offset for y-axis label. Default is 0.</span>
<span class="sd">        - ylabel_align (str, optional): Alignment for y-axis label. Default is &#39;left&#39;.</span>
<span class="sd">        - legend (bool, optional): Whether to show legend. Default is False.</span>
<span class="sd">        - variable_names (list, optional): List of variable names. Default is variables.</span>
<span class="sd">        - legend_xoffset (float, optional): X offset for legend. Default is xlim[1] / 2.</span>
<span class="sd">        - legend_yoffset (float, optional): Y offset for legend. Default is 0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        - ax: Matplotlib axes object.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker_s&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="n">marker_edgecolor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker_edgecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;#000000&#39;</span><span class="p">)</span>
    <span class="n">marker_c</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker_c&#39;</span><span class="p">,</span> <span class="s1">&#39;#000000&#39;</span><span class="p">)</span>
    <span class="n">label_fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_fontsize&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">table_fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;table_fontsize&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Hazard Ratio&#39;</span><span class="p">)</span>
    <span class="n">xlim</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlim&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">)</span>
    <span class="n">xticks</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xticks&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xticks_labelsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xticks_labelsize&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">N1</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;N1&#39;</span><span class="p">,</span> <span class="s1">&#39;N1&#39;</span><span class="p">)</span>
    <span class="n">N2</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;N2&#39;</span><span class="p">,</span> <span class="s1">&#39;N2&#39;</span><span class="p">)</span>
    <span class="n">sort_by</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sortby&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sort_by</span><span class="p">:</span>
        <span class="n">perf</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sort_by</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">xticks</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">perf</span><span class="p">[</span><span class="n">hi</span><span class="p">])),</span> <span class="mi">50</span><span class="p">)]</span>

    <span class="n">population</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">perf</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">variable_shapes</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable_shapes&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">marker</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)))}</span>

    <span class="n">populations</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;populations&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">perf</span><span class="p">[</span><span class="n">population</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">population_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;population_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    
    <span class="n">population_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">populations</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;population_colors&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)))}</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">perf</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="n">group</span> <span class="k">else</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>

    <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">offset2</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">gix</span><span class="p">,</span> <span class="n">gi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
        <span class="n">gix</span> <span class="o">=</span> <span class="n">gix</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">gix</span>
        <span class="k">for</span> <span class="n">vix</span><span class="p">,</span> <span class="n">vi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">pix</span><span class="p">,</span> <span class="n">pi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">populations</span><span class="p">):</span>
                    <span class="n">pix</span> <span class="o">=</span> <span class="n">pix</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">populations</span><span class="p">))</span>
                    <span class="n">marker_edgecolor</span> <span class="o">=</span> <span class="n">population_colors</span><span class="p">[</span><span class="n">pi</span><span class="p">]</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">variable_shapes</span><span class="p">[</span><span class="n">vi</span><span class="p">]</span>
                    
                    <span class="n">i</span> <span class="o">=</span> <span class="n">perf</span><span class="p">[(</span><span class="n">perf</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">vi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">perf</span><span class="p">[</span><span class="n">population</span><span class="p">]</span> <span class="o">==</span> <span class="n">pi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">perf</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">==</span> <span class="n">gi</span><span class="p">)]</span>

                    <span class="n">pname</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">population_name</span><span class="p">:</span> 
                        <span class="n">pname</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">population_name</span><span class="p">]</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">vix</span> <span class="o">+</span> <span class="n">pix</span> <span class="o">+</span> <span class="n">gix</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="n">lo</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="n">hi</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">marker_edgecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">lo</span><span class="p">],</span> <span class="n">vix</span> <span class="o">+</span> <span class="n">pix</span> <span class="o">+</span> <span class="n">gix</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">marker_edgecolor</span> <span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">hi</span><span class="p">],</span> <span class="n">vix</span> <span class="o">+</span> <span class="n">pix</span> <span class="o">+</span> <span class="n">gix</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">marker_edgecolor</span> <span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="n">hr</span><span class="p">],</span> <span class="n">vix</span> <span class="o">+</span> <span class="n">pix</span> <span class="o">+</span> <span class="n">gix</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">marker_edgecolor</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>

                    <span class="n">ttx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;population_label_fixed_position&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">ttx</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">lo</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ttx</span> <span class="k">else</span> <span class="n">ttx</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ttx</span><span class="p">,</span> <span class="n">vix</span><span class="o">+</span><span class="n">pix</span><span class="o">+</span><span class="n">gix</span><span class="o">+</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;population_label_offset&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">pname</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;population_label_fontsize&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

                    <span class="n">ix</span><span class="o">+=</span><span class="mi">1</span>
                    
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel_offset&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">vix</span> <span class="o">+</span> <span class="n">pix</span> <span class="o">+</span> <span class="n">gix</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel_offset&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
            <span class="n">gi</span><span class="p">,</span> 
            <span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_fontsize&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel_align&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="p">)</span>


    <span class="c1"># draw legend box</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">variable__names</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;variable_names&#39;</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vi</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_xoffset&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">vi</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">variable_shapes</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_xoffset&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vi</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_yoffset&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">variable__names</span><span class="p">[</span><span class="n">vi</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_fontsize&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

                    

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">xticks_labelsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">);</span>

    <span class="c1"># ylim=[-0.25, gix*(vix-1) + 0.5]</span>
    <span class="c1"># ax.set_ylim(ylim)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">left</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span></div>

<span class="c1">#### Plot survival for multiple iterations of the data. Training / Testing splits. </span>

<div class="viewcode-block" id="simple_survival_plot"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.simple_survival_plot">[docs]</a><span class="k">def</span> <span class="nf">simple_survival_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="n">kmfs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label</span><span class="p">:</span>
        <span class="n">kmf</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">()</span>
        <span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_AVAL</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_o</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">OS_CNSR</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">name</span> <span class="p">)),</span> <span class="n">ix</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="cox_functions"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.cox_functions">[docs]</a><span class="k">def</span> <span class="nf">cox_functions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">predictor</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">control_arm_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iteration_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">predictor</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">predictor</span> <span class="o">=</span> <span class="p">[</span><span class="n">predictor</span><span class="p">]</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">predictor</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">])</span>
    <span class="n">folds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">iteration_column</span><span class="p">])</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data_</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">iteration_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">fold</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="c1"># Set the control as 0 and the target arm as 1</span>
            <span class="n">data_</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fold</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;__label__&#39;</span><span class="p">)]</span> <span class="o">!=</span> <span class="n">control_arm_label</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>  

            <span class="n">cph</span> <span class="o">=</span> <span class="n">CoxPHFitter</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_</span><span class="p">[[</span><span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fold</span><span class="p">)]],</span> <span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="n">sm</span> <span class="o">=</span> <span class="n">cph</span><span class="o">.</span><span class="n">summary</span><span class="p">[[</span><span class="s1">&#39;exp(coef)&#39;</span><span class="p">,</span> <span class="s1">&#39;exp(coef) lower 95%&#39;</span><span class="p">,</span> <span class="s1">&#39;exp(coef) upper 95%&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sm</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Population&#39;</span><span class="p">,</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span> <span class="s1">&#39;hr_lo&#39;</span><span class="p">,</span> <span class="s1">&#39;hr_hi&#39;</span><span class="p">,</span> <span class="s1">&#39;pval&#39;</span><span class="p">]</span>
            
            <span class="c1"># for label in labels:</span>
                <span class="c1"># sm[&#39;prev_{}&#39;.format(label)] = data[&#39;prev_{}&#39;.format(label)].mean()</span>
            <span class="n">Ns</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">data_</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                <span class="n">sm</span><span class="p">[</span><span class="s1">&#39;N_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Ns</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                
            <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">inst</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Fold </span><span class="si">{}</span><span class="s1"> has an error&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fold</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
            <span class="k">pass</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="kmf_survival_functions"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.kmf_survival_functions">[docs]</a><span class="k">def</span> <span class="nf">kmf_survival_functions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">predictor</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">iteration_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s1">&#39;event&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Retrieve all KM survival functions using input data&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">predictor</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">predictor</span> <span class="o">=</span> <span class="p">[</span><span class="n">predictor</span><span class="p">]</span>

    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">predictor</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">])</span>
    <span class="n">folds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">iteration_column</span><span class="p">])</span>
    <span class="n">survival_functions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">survival_functions_fold</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data_</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">iteration_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">fold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;__label__&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">kmf</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">(</span> <span class="n">label</span><span class="o">=</span><span class="n">fold</span> <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_</span><span class="p">[</span><span class="n">time</span><span class="p">],</span> <span class="n">data_</span><span class="p">[</span><span class="n">event</span><span class="p">])</span>
                <span class="n">survival_functions_fold</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kmf</span><span class="o">.</span><span class="n">survival_function_</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">kmfi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">survival_functions_fold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">kmfi_ci</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">kmfi</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">kmfi</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">kmfi</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.975</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">kmfi_ci</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;CI95LO&#39;</span><span class="p">,</span><span class="s1">&#39;CI95HI&#39;</span><span class="p">]</span>
        
        <span class="n">survival_functions</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmfi_ci</span>
    
    
    
    
    <span class="k">return</span> <span class="n">survival_functions</span></div>

<div class="viewcode-block" id="median_plot_survival"><a class="viewcode-back" href="../../../samecode.survival.html#samecode.survival.plot.median_plot_survival">[docs]</a><span class="k">def</span> <span class="nf">median_plot_survival</span><span class="p">(</span><span class="n">kmfs</span><span class="p">,</span> <span class="n">cox</span><span class="o">=</span><span class="p">[],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#573411&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">plot_medians</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">label_font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">hr_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">hr_label_offset</span><span class="o">=-</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">median_time_offset</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">name_offset</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">median_time_fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot survival for multiple iterations of the data. Training / Testing splits. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">linecolor</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linecolor</span> <span class="o">=</span> <span class="n">color</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">agg</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="s1">&#39;CI95HI&#39;</span><span class="p">],</span> <span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="s1">&#39;CI95LO&#39;</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">)</span>
    
    
    <span class="c1"># labels</span>
    <span class="k">if</span> <span class="n">cox</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="n">cox</span> <span class="o">=</span> <span class="n">cox</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">hr_label</span> <span class="o">=</span> <span class="s1">&#39;HR=</span><span class="si">{:.2f}</span><span class="s1"> (95% CI: </span><span class="si">{:.2f}</span><span class="s1">, </span><span class="si">{:.2f}</span><span class="s1">); P=</span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cox</span><span class="o">.</span><span class="n">hr</span><span class="p">,</span> <span class="n">cox</span><span class="o">.</span><span class="n">hr_lo</span><span class="p">,</span> <span class="n">cox</span><span class="o">.</span><span class="n">hr_hi</span><span class="p">,</span> <span class="n">cox</span><span class="o">.</span><span class="n">pval</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hr_label_offset</span><span class="p">,</span> <span class="n">hr_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hr_font_size</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

     
    <span class="c1"># medians</span>
    <span class="k">if</span> <span class="n">plot_medians</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">agg</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">median_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">agg</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">agg</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">median_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">median_time</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">agg</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># median label</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">median_time</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">median_time</span> <span class="o">+</span> <span class="n">median_time_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.53</span> <span class="o">+</span> <span class="n">median_time_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">median_time</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">median_time_fontsize</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">median_time</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#a19595&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">median_time</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">median_time</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#a19595&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># name </span>
    <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kmfs</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">agg</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cox</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">name_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (N=</span><span class="si">{:.0f}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">cox</span><span class="p">[</span><span class="s1">&#39;N_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)]),</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">name_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    
    <span class="c1"># general aspect</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Survival Probability&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_font_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Timeline&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_font_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;#7a7974&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span></div>
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Gustavo Arango.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>